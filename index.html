<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caccia alle Sfere del Drago üêâ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Passion+One:wght@400;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Passion One', cursive;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDB913 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Nuvole animate in background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(255,255,255,0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(255,255,255,0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 80%, rgba(255,255,255,0.25) 0%, transparent 50%);
            animation: clouds 30s infinite ease-in-out;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes clouds {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(20px); }
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(180deg, #1a4d7a 0%, #2c5f8d 100%);
            border-radius: 30px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.5),
                0 0 0 8px #FF6B35,
                0 0 0 12px #FDB913;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .header {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
            position: relative;
            border-bottom: 8px solid #FDB913;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                #FF6B35 25%, 
                #FDB913 50%, 
                #FF6B35 75%, 
                transparent 100%);
            box-shadow: 0 2px 10px rgba(253, 185, 19, 0.8);
        }

        .header h1 {
            font-family: 'Bangers', cursive;
            font-size: 4em;
            text-shadow: 
                4px 4px 0px #C54000,
                6px 6px 0px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            letter-spacing: 3px;
            animation: titlePulse 2s infinite ease-in-out;
            -webkit-text-stroke: 3px black;
            paint-order: stroke fill;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .dragon-ball-counter {
            font-size: 1.6em;
            margin-top: 15px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            -webkit-text-stroke: 2px black;
            paint-order: stroke fill;
        }

        .mini-ball {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            border-radius: 50%;
            border: 3px solid #FF6B35;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.3),
                inset -2px -2px 8px rgba(0,0,0,0.2),
                inset 2px 2px 8px rgba(255,255,255,0.5);
            animation: bobbing 1.5s infinite ease-in-out;
        }

        @keyframes bobbing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .content {
            padding: 40px;
            background: linear-gradient(180deg, #2c5f8d 0%, #1a4d7a 100%);
        }

        .welcome-screen {
            text-align: center;
        }

        .welcome-screen h2 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 3em;
            font-weight: 900;
            text-shadow: 
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000,
                3px 3px 0px #FF6B35,
                5px 5px 0px rgba(0,0,0,0.5);
            background: #1a3a52;
            padding: 20px 40px;
            border-radius: 20px;
            border: 4px solid #FDB913;
            display: inline-block;
        }

        .welcome-screen p {
            font-size: 1.5em;
            color: #ffffff;
            line-height: 1.8;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-weight: 400;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid rgba(253, 185, 19, 0.5);
            -webkit-text-stroke: 1px black;
            paint-order: stroke fill;
        }

        .btn {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            border: 4px solid #FDB913;
            padding: 18px 50px;
            font-size: 1.7em;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                0 6px 20px rgba(255, 107, 53, 0.5),
                inset 0 -4px 0 rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Bangers', cursive;
            -webkit-text-stroke: 2px black;
            paint-order: stroke fill;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 10px 30px rgba(255, 107, 53, 0.7),
                inset 0 -4px 0 rgba(0,0,0,0.2);
            border-color: #FF6B35;
        }

        .btn:active {
            transform: translateY(-1px) scale(1.03);
        }

        .case-screen {
            display: none;
        }

        .case-number {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            margin-bottom: 25px;
            font-weight: 900;
            font-size: 1.5em;
            border: 3px solid #FDB913;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            -webkit-text-stroke: 2px black;
            paint-order: stroke fill;
        }

        .case-content {
            background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 5px solid #FDB913;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.3),
                inset 0 2px 10px rgba(253, 185, 19, 0.2);
        }

        .case-content h3 {
            color: #FF6B35;
            margin-bottom: 20px;
            font-size: 2em;
            font-weight: 900;
            text-shadow: 2px 2px 0px rgba(253, 185, 19, 0.3);
            -webkit-text-stroke: 1.5px black;
            paint-order: stroke fill;
        }

        .case-content p {
            color: #1a4d7a;
            line-height: 1.9;
            font-size: 1.25em;
            white-space: pre-line;
            font-weight: 400;
        }

        .answer-section {
            margin-top: 30px;
        }

        .answer-section > label {
            display: block;
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 25px;
            font-size: 1.7em;
            text-shadow: 
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000,
                3px 3px 0px #FF6B35,
                5px 5px 0px rgba(0,0,0,0.5);
            background: #1a3a52;
            padding: 15px 25px;
            border-radius: 15px;
            border: 3px solid #FDB913;
        }

        .option {
            background: linear-gradient(135deg, #ffffff 0%, #fff8e1 100%);
            border: 4px solid #FDB913;
            border-radius: 20px;
            padding: 20px 25px;
            margin-bottom: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            font-size: 1.25em;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-weight: 400;
        }

        .option:hover {
            border-color: #FF6B35;
            background: linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%);
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .option input[type="radio"] {
            margin-right: 18px;
            width: 26px;
            height: 26px;
            cursor: pointer;
            accent-color: #FF6B35;
        }

        .option.selected {
            border-color: #FF6B35;
            background: linear-gradient(135deg, #ffe0b2 0%, #ffcc80 100%);
            box-shadow: 
                0 6px 20px rgba(255, 107, 53, 0.5),
                inset 0 2px 10px rgba(255, 107, 53, 0.2);
            transform: translateX(10px) scale(1.02);
        }

        .option label {
            cursor: pointer;
            flex: 1;
            color: #1a4d7a;
            font-weight: 700;
        }

        .submit-btn {
            margin-top: 25px;
            width: 100%;
        }

        .message {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            display: none;
            animation: messageAppear 0.5s ease-out;
            -webkit-text-stroke: 1.5px black;
            paint-order: stroke fill;
        }

        @keyframes messageAppear {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .error-message {
            background: linear-gradient(135deg, #ff5252 0%, #f44336 100%);
            color: white;
            border: 3px solid #c62828;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
        }

        .success-message {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
            border: 3px solid #2e7d32;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .radar-screen {
            display: none;
            text-align: center;
        }

        .radar-screen h2 {
            color: #ffffff;
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 
                3px 3px 0px #FF6B35,
                5px 5px 0px rgba(0,0,0,0.5);
            background: rgba(0, 0, 0, 0.6);
            padding: 20px 40px;
            border-radius: 20px;
            border: 4px solid #FDB913;
            display: inline-block;
            -webkit-text-stroke: 2px black;
            paint-order: stroke fill;
        }

        /* Sfera del Drago grande e animata */
        .dragon-ball-display {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 30px auto;
            animation: dragonBallFloat 3s infinite ease-in-out;
        }

        @keyframes dragonBallFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .dragon-ball {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at 35% 35%, #FFD700, #FFA500, #FF8C00);
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 20px 60px rgba(255, 140, 0, 0.6),
                inset -15px -15px 30px rgba(0,0,0,0.3),
                inset 15px 15px 30px rgba(255,255,255,0.3);
            border: 6px solid #FF6B35;
        }

        .dragon-ball::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 30px;
            width: 60px;
            height: 50px;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.6), transparent);
            border-radius: 50%;
            transform: rotate(-30deg);
        }

        .star-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            width: 35px;
            height: 35px;
            animation: starTwinkle 1s infinite alternate;
        }
        
        .star svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        @keyframes starTwinkle {
            0% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.1); }
        }

        .radar-container {
            position: relative;
            width: 350px;
            height: 350px;
            margin: 40px auto;
            background: radial-gradient(circle, #2d5016 0%, #1a2f0f 70%, #0d1508 100%);
            border-radius: 50%;
            border: 12px solid #8B4513;
            box-shadow: 
                0 15px 50px rgba(0,0,0,0.6),
                inset 0 0 50px rgba(0,0,0,0.5),
                0 0 20px rgba(139, 69, 19, 0.4);
            overflow: hidden;
        }

        /* Antenna del radar */
        .radar-container::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 50px;
            background: linear-gradient(180deg, #8B4513 0%, #654321 100%);
            border-radius: 5px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        /* Pulsante rosso sull'antenna */
        .radar-container::after {
            content: '';
            position: absolute;
            top: -65px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 25px;
            background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000);
            border-radius: 50%;
            border: 3px solid #8B4513;
            box-shadow: 
                0 2px 10px rgba(255, 0, 0, 0.6),
                inset -2px -2px 5px rgba(0,0,0,0.3);
            animation: buttonBlink 1.5s infinite;
        }

        @keyframes buttonBlink {
            0%, 100% { opacity: 1; box-shadow: 0 2px 10px rgba(255, 0, 0, 0.6); }
            50% { opacity: 0.5; box-shadow: 0 2px 20px rgba(255, 0, 0, 0.9); }
        }

        .radar-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
        }

        .radar-line {
            position: absolute;
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .radar-line.horizontal {
            width: 100%;
            height: 2px;
            top: 50%;
            left: 0;
        }

        .radar-line.vertical {
            width: 2px;
            height: 100%;
            left: 50%;
            top: 0;
        }

        .radar-circle {
            position: absolute;
            border: 2px solid rgba(0, 255, 0, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .radar-sweep {
            position: absolute;
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, 
                rgba(0, 255, 0, 0) 0%, 
                rgba(0, 255, 0, 0.8) 100%);
            top: 50%;
            left: 50%;
            transform-origin: 0% 50%;
            animation: radarSweep 3s linear infinite;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
        }

        @keyframes radarSweep {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .radar-blip {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #00ff00, #00cc00);
            border-radius: 50%;
            top: 30%;
            left: 60%;
            animation: blipPulse 1s infinite;
            box-shadow: 
                0 0 10px #00ff00,
                0 0 20px #00ff00,
                0 0 30px rgba(0, 255, 0, 0.5);
        }

        /* Triangolo rosso al centro del radar */
        .radar-center-marker {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 20px solid #ff0000;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8));
            z-index: 10;
        }

        @keyframes blipPulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 
                    0 0 10px #00ff00,
                    0 0 20px #00ff00,
                    0 0 30px rgba(0, 255, 0, 0.5);
            }
            50% { 
                opacity: 0.5; 
                transform: scale(1.3);
                box-shadow: 
                    0 0 15px #00ff00,
                    0 0 30px #00ff00,
                    0 0 45px rgba(0, 255, 0, 0.8);
            }
        }

        .coordinates-display {
            background: linear-gradient(135deg, #FDB913 0%, #FF6B35 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-top: 30px;
            font-size: 1.5em;
            font-weight: 700;
            border: 4px solid #FF6B35;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            -webkit-text-stroke: 1.5px black;
            paint-order: stroke fill;
        }

        .completion-screen {
            display: none;
            text-align: center;
        }

        .completion-screen h2 {
            color: #ffffff;
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 30px;
            text-shadow: 
                4px 4px 0px #FF6B35,
                6px 6px 0px rgba(0,0,0,0.5);
            animation: completionBounce 1s infinite;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px 50px;
            border-radius: 25px;
            border: 5px solid #FDB913;
            display: inline-block;
            -webkit-text-stroke: 3px black;
            paint-order: stroke fill;
        }

        @keyframes completionBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .completion-screen p {
            font-size: 1.7em;
            color: white;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.6;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid rgba(253, 185, 19, 0.5);
            -webkit-text-stroke: 1px black;
            paint-order: stroke fill;
        }

        .all-balls-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px 0;
        }

        .completion-ball {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 35% 35%, #FFD700, #FFA500, #FF8C00);
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 10px 30px rgba(255, 140, 0, 0.6),
                inset -8px -8px 15px rgba(0,0,0,0.3),
                inset 8px 8px 15px rgba(255,255,255,0.3);
            border: 4px solid #FF6B35;
            animation: completionBallFloat 2s infinite ease-in-out;
        }

        .completion-ball:nth-child(odd) {
            animation-delay: 0.3s;
        }

        @keyframes completionBallFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .completion-ball .star {
            font-size: 12px;
        }

        /* Popup colpo di scena */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            animation: popupFadeIn 0.5s ease-out;
        }

        @keyframes popupFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, #1a4d7a 0%, #2c5f8d 100%);
            border-radius: 30px;
            padding: 50px;
            max-width: 700px;
            width: 90%;
            box-shadow: 
                0 0 0 8px #FF6B35,
                0 0 0 12px #FDB913,
                0 20px 60px rgba(0,0,0,0.8),
                0 0 100px rgba(255, 107, 53, 0.6);
            animation: popupBounce 0.6s ease-out;
        }

        @keyframes popupBounce {
            0% { transform: translate(-50%, -50%) scale(0.3); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .popup-content h2 {
            color: #FFD700;
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 30px;
            text-shadow: 
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000,
                4px 4px 0px #C41E3A,
                6px 6px 0px rgba(0,0,0,0.5);
            animation: twistPulse 1.5s infinite;
            -webkit-text-stroke: 2px black;
            paint-order: stroke fill;
        }

        @keyframes twistPulse {
            0%, 100% { transform: scale(1); color: #FFD700; }
            50% { transform: scale(1.1); color: #FF6B35; }
        }

        .popup-content p {
            color: #ffffff;
            font-size: 1.4em;
            line-height: 1.8;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-weight: 400;
            -webkit-text-stroke: 1px black;
            paint-order: stroke fill;
        }

        /* Schermata drago */
        .dragon-screen {
            display: none;
            text-align: center;
        }

        .dragon-container {
            margin: 40px auto;
            padding: 30px;
            background: radial-gradient(circle, rgba(45, 122, 45, 0.3) 0%, rgba(26, 77, 26, 0.1) 70%);
            border-radius: 20px;
            border: 5px solid #2d7a2d;
            box-shadow: 
                0 0 50px rgba(0, 255, 0, 0.4),
                inset 0 0 30px rgba(0, 255, 0, 0.2);
            animation: dragonAura 2s infinite;
        }

        @keyframes dragonAura {
            0%, 100% { 
                box-shadow: 
                    0 0 50px rgba(0, 255, 0, 0.4),
                    inset 0 0 30px rgba(0, 255, 0, 0.2);
            }
            50% { 
                box-shadow: 
                    0 0 80px rgba(0, 255, 0, 0.6),
                    inset 0 0 50px rgba(0, 255, 0, 0.3);
            }
        }

        .dragon-ascii {
            display: inline-block;
        }

        @keyframes dragonFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes dragonTextGlow {
            0%, 100% { 
                text-shadow: 4px 4px 0px #C41E3A, 6px 6px 0px rgba(0,0,0,0.5);
            }
            50% { 
                text-shadow: 
                    4px 4px 0px #C41E3A, 
                    6px 6px 0px rgba(0,0,0,0.5),
                    0 0 30px #FFD700,
                    0 0 50px #FFD700;
            }
        }

        @keyframes finalCasePulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 8px 30px rgba(196, 30, 58, 0.8);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
            
            .dragon-ball-display,
            .dragon-ball {
                width: 150px;
                height: 150px;
            }
            
            .radar-container {
                width: 280px;
                height: 280px;
            }
            
            .completion-ball {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ CACCIA ALLE SFERE DEL DRAGO üêâ</h1>
            <div class="dragon-ball-counter">
                <span class="mini-ball"></span>
                Sfere Raccolte: <strong><span id="ballsCollected">0</span>/7</strong>
                <span class="mini-ball"></span>
            </div>
        </div>

        <div class="content">
            <!-- Schermata iniziale -->
            <div class="welcome-screen" id="welcomeScreen">
                <h2>Benvenuto, Benito!</h2>
                <p>
                    Nelle ombre della casa si celano le <strong>Sette Sfere del Drago</strong>, reliquie antiche dal potere incommensurabile. üêâ<br>
                    Solo i pi√π valorosi sapranno trovarle, affrontando prove degne di un vero eroe.<br><br>
                    Ogni sfera √® protetta da un <strong>caso clinico misterioso</strong>, un enigma che metter√† alla prova la tua mente e il tuo coraggio.<br>
                    Risolvine uno, e le <em>coordinate segrete</em> di una Sfera ti saranno rivelate.<br><br>
                    Sette sfide, sette reliquie, un solo destino: <strong>riunirle tutte e far avverare il tuo desiderio pi√π profondo</strong>.<br>
                    Sei pronto a intraprendere questa missione leggendaria?
                </p>
                <button class="btn" onclick="startHunt()">INIZIA LA CACCIA!</button>
            </div>

            <!-- Schermata caso clinico -->
            <div class="case-screen" id="caseScreen">
                <div class="case-number">CASO <span id="caseNumber">1</span></div>
                
                <div class="case-content">
                    <h3 id="caseTitle">Titolo del Caso</h3>
                    <p id="caseDescription">Descrizione del caso...</p>
                </div>

                <div class="answer-section">
                    <label>Seleziona la diagnosi corretta:</label>
                    <div id="optionsContainer">
                        <!-- Le opzioni verranno generate dinamicamente -->
                    </div>
                    
                    <button class="btn submit-btn" onclick="checkAnswer()">CONFERMA RISPOSTA</button>
                    
                    <div class="message error-message" id="errorMessage">
                        Risposta non corretta. Riprova!
                    </div>
                    
                    <div class="message success-message" id="successMessage">
                        ‚ú® Risposta corretta! Accesso al Dragon Radar... ‚ú®
                    </div>
                </div>
            </div>

            <!-- Schermata Radar -->
            <div class="radar-screen" id="radarScreen">
                <h2>üéØ SFERA TROVATA!</h2>
                
                <div class="dragon-ball-display">
                    <div class="dragon-ball">
                        <div class="star-container" id="currentStar">
                            <!-- Le stelle verranno aggiunte dinamicamente -->
                        </div>
                    </div>
                </div>

                <p style="color: #ffffff; font-size: 1.8em; font-weight: 900; margin: 20px auto; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); background: rgba(0, 0, 0, 0.6); padding: 15px 30px; border-radius: 15px; border: 3px solid #FDB913; display: inline-block;">
                    SFERA <span id="ballNumber">1</span> con <span id="starCount"></span>
                </p>

                <div class="radar-container">
                    <div class="radar-grid">
                        <div class="radar-line horizontal"></div>
                        <div class="radar-line vertical"></div>
                        <div class="radar-circle" style="width: 80%; height: 80%;"></div>
                        <div class="radar-circle" style="width: 60%; height: 60%;"></div>
                        <div class="radar-circle" style="width: 40%; height: 40%;"></div>
                        <div class="radar-circle" style="width: 20%; height: 20%;"></div>
                        <div class="radar-sweep"></div>
                        <div class="radar-blip"></div>
                        <div class="radar-center-marker"></div>
                    </div>
                </div>

                <div class="coordinates-display">
                    üìç <strong>COORDINATE:</strong><br>
                    <span id="coordinates"></span>
                </div>

                <button class="btn" onclick="nextCase()" style="margin-top: 30px;">PROSSIMA SFERA</button>
            </div>

            <!-- Schermata completamento -->
            <div class="completion-screen" id="completionScreen">
                <h2>üéâ CONGRATULAZIONI! üéâ</h2>
                <p>
                    Hai raccolto tutte e 7 le Sfere del Drago!<br>
                    Sei pronto a evocare il Drago Shenron e esprimere il tuo desiderio!
                </p>
                
                <div class="all-balls-container">
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 42%; left: 46%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 58%; left: 54%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 38%; left: 50%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 56%; left: 42%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 56%; left: 58%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 42%; left: 42%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 42%; left: 58%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 58%; left: 42%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 58%; left: 58%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 35%; left: 50%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 52%; left: 38%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 52%; left: 62%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 65%; left: 44%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 65%; left: 56%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 38%; left: 42%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 38%; left: 58%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 50%; left: 35%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 50%; left: 65%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 62%; left: 42%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 62%; left: 58%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                    <div class="completion-ball">
                        <div class="star-container">
                            <span class="star" style="top: 32%; left: 50%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 45%; left: 40%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 45%; left: 60%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 56%; left: 35%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 56%; left: 65%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 68%; left: 44%; transform: translate(-50%, -50%);">‚≠ê</span>
                            <span class="star" style="top: 68%; left: 56%; transform: translate(-50%, -50%);">‚≠ê</span>
                        </div>
                    </div>
                </div>

                <p style="font-size: 1.8em; color: #ffffff; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); background: rgba(0, 0, 0, 0.6); padding: 20px 40px; border-radius: 20px; border: 4px solid #FDB913; display: inline-block;">
                    üêâ Adesso sei tu il super sayan della medicina üêâ
                </p>
                
                <button class="btn" onclick="showFinalTwist()" style="margin-top: 30px;">EVOCA IL DRAGO SHENRON!</button>
            </div>

            <!-- Popup colpo di scena -->
            <div class="popup-overlay" id="twistPopup">
                <div class="popup-content">
                    <h2>‚ö° ASPETTA! ‚ö°</h2>
                    <p>
                        Le Sfere del Drago brillano intensamente, ma qualcosa non va...<br><br>
                        <strong style="color: #FF6B35; font-size: 1.3em;">Una barriera energetica impedisce l'evocazione!</strong><br><br>
                        Per rompere il sigillo e liberare il potere di Shenron, devi superare<br>
                        <strong style="color: #FDB913; font-size: 1.4em;">L'ULTIMO ENIGMA MEDICO</strong><br><br>
                        Solo il pi√π saggio e coraggioso potr√† evocare il Drago Leggendario!<br>
                        Sei pronto per l'ultima sfida? üêâ
                    </p>
                    <button class="btn" onclick="startFinalChallenge()">ACCETTO LA SFIDA!</button>
                </div>
            </div>

            <!-- Schermata caso finale -->
            <div class="case-screen" id="finalCaseScreen">
                <div class="case-number" style="background: linear-gradient(135deg, #FDB913, #8B0000); border-color: #FFD700; animation: finalCasePulse 2s infinite;">
                    üêâ ENIGMA FINALE üêâ
                </div>
                
                <div class="case-content" style="border-color: #FDB913; box-shadow: 0 8px 25px rgba(196, 30, 58, 0.5), inset 0 2px 10px rgba(196, 30, 58, 0.2);">
                    <h3 id="finalCaseTitle" style="color: #FDB913;">Titolo del Caso Finale</h3>
                    <p id="finalCaseDescription">Descrizione del caso...</p>
                </div>

                <div class="answer-section">
                    <label>Seleziona la diagnosi corretta per evocare Shenron:</label>
                    <div id="finalOptionsContainer">
                        <!-- Le opzioni verranno generate dinamicamente -->
                    </div>
                    
                    <button class="btn submit-btn" onclick="checkFinalAnswer()" style="background: linear-gradient(135deg, #C41E3A, #8B0000); border-color: #FFD700;">CONFERMA E EVOCA IL DRAGO!</button>
                    
                    <div class="message error-message" id="finalErrorMessage">
                        Risposta non corretta. Il sigillo resiste!
                    </div>
                    
                    <div class="message success-message" id="finalSuccessMessage">
                        ‚ú® IL SIGILLO √à SPEZZATO! SHENRON STA ARRIVANDO! ‚ú®
                    </div>
                </div>
            </div>

            <!-- Schermata Drago Shenron -->
            <div class="dragon-screen" id="dragonScreen">
                <h2 style="color: #FFD700; font-size: 3.5em; text-shadow: 4px 4px 0px #C41E3A, 6px 6px 0px rgba(0,0,0,0.5); animation: dragonTextGlow 2s infinite;">üêâ SHENRON √à APPARSO! üêâ</h2>
                
            
                <div class="dragon-container">
                    <img src="drago.png" alt="Shenron il Drago Sacro" class="dragon-image" style="max-width: 600px; width: 100%; height: auto; animation: dragonFloat 3s infinite ease-in-out; filter: drop-shadow(0 0 30px rgba(0, 255, 0, 0.6));">
                </div>

                <p style="color: #ffffff; font-size: 2em; font-weight: 900; margin: 30px auto; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); background: linear-gradient(135deg, #2d7a2d 0%, #1a4d1a 100%); padding: 25px 40px; border-radius: 20px; border: 5px solid #FFD700; display: inline-block; max-width: 800px;">
                    <span style="color: #FFD700;">"ESPRIMI IL TUO DESIDERIO, MORTALE!"</span><br><br>
                    <span style="font-size: 0.7em; color: #90EE90;">Il Drago ti aspetta in:</span><br>
                    <span style="color: #FFD700; font-size: 1.1em;" id="finalCoordinates"></span>
                </p>

                
            </div>
        </div>
    </div>

    <script>
        const cases = [
            {
                title: "Tosse cronica e calo ponderale",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Uomo di 42 anni, immigrato da paese ad alta endemia tubercolare, giunge per tosse persistente da 3 mesi, " +
                    "produttiva con escreato striato di sangue (emoftoe lieve), febbricola serale, sudorazione notturna e calo ponderale di circa 6 kg.\n" +
                    "Non ha comorbilit√† note. Riferisce contatto prolungato con un parente affetto da TBC polmonare 6 mesi fa.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 115/70 mmHg, FC 92 bpm, T 37.8¬∞C. Torace: rumori aspri al campo medio-superiore destro, rantoli crepitanti.\n" +
                    "Paziente magro, lievemente pallido; nessun altro segno focale.\n\n" +
                    "üß™ Esami:\n" +
                    "Rx torace: opacit√† nodulare apicale destra con cavitazione, infiltrati multipli.\n" +
                    "Esame diretto dell'espettorato: bacilli alcool-acido resistenti (BAAR) positivi.\n" +
                    "Test Mantoux: positivo (> 15 mm).\n\n" +
                    "üìã Nota:\n" +
                    "Il paziente √® non fumatore; nessuna storia di asma o BPCO.",
                options: [
                    "Polmonite batterica acquisita in comunit√†",
                    "Tubercolosi polmonare attiva",
                    "Carcinoma polmonare",
                    "Bronchiectasie con sovrainfezione"
                ],
                correctAnswer: 1,
                coordinates: "Vai in CUCINA e apri il CASSETTO accanto al frigorifero",
                star: "‚≠ê"
            },
            {
                title: "Dolore addominale acuto e vomito",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Donna di 38 anni, nota per colelitiasi asintomatica, giunge in PS per dolore epigastrico intenso a sbarra, " +
                    "insorto 6 ore fa dopo una cena abbondante e ricca di grassi. Nausea e vomito ripetuto, nessun miglioramento con antiacidi.\n" +
                    "Assume alcol occasionalmente; nega traumi recenti.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 108/65 mmHg, FC 110 bpm, FR 22/min, T 38.1¬∞C.\n" +
                    "Addome: dolorabilit√† intensa in epigastrio, lieve distensione, segni di difesa ma non peritonismo franco.\n" +
                    "Peristalsi ridotta. Gibbi renali negativi.\n\n" +
                    "üß™ Esami:\n" +
                    "Amilasi sierica 850 U/L (VN <100), lipasi 1200 U/L (VN <60).\n" +
                    "Leucocitosi 14.5√ó10^3/¬µL, PCR 12 mg/dL.\n" +
                    "Glicemia 145 mg/dL, LDH 280 U/L, AST/ALT lievemente aumentate.\n" +
                    "Ecografia addome: colecisti con calcoli; pancreas mal visualizzabile per meteorismo.\n\n" +
                    "üìã Nota:\n" +
                    "Nessuna storia di ipertrigliceridemia; non uso cronico di farmaci.",
                options: [
                    "Gastrite acuta",
                    "Pancreatite acuta (presumibilmente biliare)",
                    "Ulcera peptica perforata",
                    "Colecistite acuta"
                ],
                correctAnswer: 1,
                coordinates: "Vai in SALOTTO, cerca dietro il CUSCINO del divano",
                star: "‚≠ê‚≠ê"
            },
            {
                title: "Dispnea improvvisa e asimmetria toracica",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Uomo di 28 anni, alto e magro (habitus longilineo), fumatore (10 sigarette/die da 5 anni),\n" +
                    "si presenta in PS per dispnea ingravescente e dolore toracico acuto destro a \"pugnalata\" insorti bruscamente durante sforzo fisico.\n" +
                    "Nega traumi, infezioni recenti o patologie polmonari note.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 100/60 mmHg, FC 120 bpm, FR 28/min, SatO‚ÇÇ 88% in aria ambiente, T 36.5¬∞C.\n" +
                    "Torace: emitorace destro espanso, ipoespansibile, FVT e MV assenti, ipertimpanismo.\n" +
                    "Turgore giugulare presente. Paziente agitato, tachipnoico, sudato.\n\n" +
                    "üß™ Esami:\n" +
                    "Emogas arterioso: ipossiemia (PaO‚ÇÇ 60 mmHg), ipocapnia lieve.\n" +
                    "Rx torace: presenza di aria libera nello spazio pleurico destro con collasso polmonare completo;\n" +
                    "deviazione mediastinica controlaterale; emidiaframma destro appiattito.\n\n" +
                    "üìã Nota:\n" +
                    "Nessun precedente episodio simile; nessuna malattia polmonare pregressa nota.",
                options: [
                    "Infarto miocardico acuto",
                    "Embolia polmonare massiva",
                    "Pneumotorace iperteso",
                    "Tamponamento cardiaco"
                ],
                correctAnswer: 2,
                coordinates: "Vai in STUDIO e cerca nel CASSETTO della scrivania",
                star: "‚≠ê‚≠ê‚≠ê"
            },
            {
                title: "Cefalea, nausea e uso di stufa a legna",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Famiglia di 4 persone (genitori di 40 e 38 anni, figli di 12 e 8 anni) si presenta in PS dopo essere stata trovata " +
                    "in casa con sintomi di cefalea intensa, nausea, vertigini, confusione lieve e astenia marcata.\n" +
                    "La sera prima hanno utilizzato una stufa a legna in ambiente poco ventilato per diverse ore.\n" +
                    "Tutti i membri della famiglia presentano sintomi simili ma di intensit√† variabile.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo (padre - caso indice):\n" +
                    "PA 125/80 mmHg, FC 105 bpm, FR 20/min, SatO‚ÇÇ 98% RA (pulsossimetria), T 36.8¬∞C.\n" +
                    "Paziente vigile, lievemente rallentato, esame neurologico senza deficit focali.\n\n" +
                    "üß™ Esami:\n" +
                    "Emogas arterioso: PaO‚ÇÇ 95 mmHg, pH 7.33, lattato 4.2 mmol/L.\n" +
                    "COHb (co-ossimetria): 22% (non fumatore).\n" +
                    "ECG: tachicardia sinusale; TC encefalo: negativa.\n\n" +
                    "üìã Nota:\n" +
                    "Nessuna esposizione nota ad alcol metilico; nessun disturbo visivo.",
                options: [
                    "Influenza stagionale con disidratazione",
                    "Intossicazione da monossido di carbonio",
                    "Intossicazione da metanolo",
                    "Cefalea tensiva con iperventilazione"
                ],
                correctAnswer: 1,
                coordinates: "Vai nella LIBRERIA e cerca sul TERZO SCAFFALE dall'alto",
                star: "‚≠ê‚≠ê‚≠ê‚≠ê"
            },
            {
                title: "Pancitopenia e splenomegalia",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Uomo di 55 anni, non fumatore. Da alcuni mesi astenia, infezioni respiratorie ricorrenti " +
                    "e facilit√† ai lividi. Nessuna epatopatia nota, consumo alcolico modesto.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 118/72 mmHg, FC 88 bpm, T 37.4¬∞C.\n" +
                    "Pallore cutaneo-mucose. Splenomegalia palpabile (4 cm sotto il costato sinistro), fegato nei limiti.\n" +
                    "Assenza di linfoadenopatie significative.\n\n" +
                    "üß™ Esami:\n" +
                    "Hb 10.1 g/dL ¬∑ GB 2.1√ó10^3/¬µL (neutrofili 900/¬µL) ¬∑ PLT 92√ó10^3/¬µL\n" +
                    "LDH lievemente ‚Üë ¬∑ VES ‚Üë ¬∑ Funzionalit√† epatica e renale nei limiti.\n" +
                    "Striscio periferico: linfociti atipici con proiezioni citoplasmatiche ('cellule capellute').\n" +
                    "Aspirato midollare: tentativo non diagnostico ('dry tap').\n\n" +
                    "üìã Nota:\n" +
                    "Flow cytometry: popolazione B CD19+ con espressione di CD11c, CD25, CD103.",
                options: [
                    "Leucemia linfatica cronica (LLC)",
                    "Leucemia a cellule capellute (Hairy Cell Leukemia)",
                    "Anemia aplastica",
                    "Ipersplenismo secondario a cirrosi"
                ],
                correctAnswer: 1,
                coordinates: "Vai in CAMERA DA LETTO e apri l'ARMADIO, cerca nel ripiano in alto",
                star: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
            },
            {
                title: "Confusione e iponatriemia euvolemica",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Uomo di 68 anni, ex fumatore (40 pacchetti/anno), ipertensione in terapia con calcio-antagonista.\n" +
                    "Da una settimana cefalea, nausea, lieve confusione e instabilit√† alla marcia.\n" +
                    "Tosse secca da alcuni mesi e calo ponderale non quantificato. Nessun diuretico, nessuna terapia SSRI.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 125/78 mmHg, FC 84 bpm, FR 16/min, SatO‚ÇÇ 97% RA, T 36.9¬∞C.\n" +
                    "Mucose umide, assenza di edemi, turgore giugulare normale. Cute e mucose non iperpigmentate.\n" +
                    "Nessun segno di disidratazione marcata. Stato mentale: rallentato ma orientato.\n\n" +
                    "üß™ Esami:\n" +
                    "Na‚Å∫ 118 mEq/L ¬∑ K‚Å∫ 4.3 mEq/L ¬∑ Cl‚Åª 86 mEq/L ¬∑ Creatinina 0.8 mg/dL ¬∑ Glicemia 98 mg/dL.\n" +
                    "Osmolalit√† sierica 255 mOsm/kg (‚Üì); osmolalit√† urinaria 520 mOsm/kg (‚Üë inappropriata).\n" +
                    "Na‚Å∫ urinario 62 mEq/L (‚Üë). Acido urico sierico basso.\n" +
                    "TSH e FT4 nei limiti. Cortisolo 8:00: 17 ¬µg/dL.\n\n" +
                    "üñºÔ∏è Imaging:\n" +
                    "Rx torace: opacit√†/massa ilare destra di 3.5 cm; TC torace in programmazione.\n\n" +
                    "üìã Nota:\n" +
                    "I sintomi sono insorti gradualmente; nessuna poliuria, nessuna compulsione a bere.",
                options: [
                    "SIADH secondaria a carcinoma polmonare a piccole cellule",
                    "Polidipsia psicogena",
                    "Iponatriemia ipovolemica da diuretici tiazidici",
                    "Insufficienza surrenalica primaria (morbo di Addison)"
                ],
                correctAnswer: 0,
                coordinates: "Vai sul BALCONE e cerca nel VASO GRANDE delle piante grasse",
                star: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
            },
            {
                title: "Anemia sideropenica e sangue occulto",
                description:
                    "ü©∫ Anamnesi:\n" +
                    "Uomo di 66 anni, iperteso ben controllato. Da 2‚Äì3 mesi astenia, dispnea da sforzo lieve,\n" +
                    "scarso appetito e calo ponderale di ~3 kg. Riferisce alvo tendenzialmente pi√π 'molle', " +
                    "con alvo irregolare ma senza sangue visibile nelle feci.\n" +
                    "Assunzione di FANS episodica per gonalgia. Non storia di sanguinamenti evidenti.\n\n" +
                    "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                    "PA 128/76 mmHg, FC 92 bpm, T 36.7¬∞C. Pallore cutaneo-mucose.\n" +
                    "Addome trattabile, non dolente; non epato-splenomegalia palpabile.\n" +
                    "Explorazione rettale: negativa per sangue fresco.\n\n" +
                    "üß™ Esami di laboratorio:\n" +
                    "Hb 9.6 g/dL ¬∑ MCV 72 fL ¬∑ MCHC ‚Üì ¬∑ Reticolociti normali.\n" +
                    "Ferritina 8 ng/mL (‚Üì), Sideremia 25 ¬µg/dL (‚Üì), Transferrina 360 mg/dL (‚Üë),\n" +
                    "Indice di saturazione 7% (‚Üì). VES lievemente ‚Üë.\n" +
                    "Test sangue occulto fecale: positivo su 2/3 campioni.\n\n" +
                    "üñºÔ∏è Indagini/Imaging:\n" +
                    "EGDS: gastrite antrale lieve, H. pylori negativo, nessun sanguinamento.\n" +
                    "Ecografia addome: nella norma. Colonscopia programmata.\n\n" +
                    "üìã Nota:\n" +
                    "Nessuna diarrea cronica, nessun dolore addominale colico; familiarit√† negativa per IBD.",
                options: [
                    "Malattia celiaca non diagnosticata",
                    "Emorroidi interne sanguinanti",
                    "Carcinoma del colon destro",
                    "Angiodisplasia del cieco"
                ],
                correctAnswer: 2,
                coordinates: "Vai in BAGNO e apri l'ARMADIETTO DELLO SPECCHIO, ripiano centrale",
                star: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
            }
        ];

        // Caso finale per evocare Shenron
        const finalCase = {
            title: "Shock settico e insufficienza multiorgano",
            description:
                "ü©∫ Anamnesi:\n" +
                "Donna di 72 anni, diabetica (HbA1c recente 8.2%), con IRC stadio 3b, giunge in PS per febbre alta (39.5¬∞C), " +
                "brividi scuotenti, confusione mentale e oliguria da 24 ore. Riferisce dolore lombare destro e disuria da 3 giorni, " +
                "per cui ha assunto paracetamolo senza antibiotici. Storia di UTI ricorrenti (ultimo episodio 2 mesi fa).\n\n" +
                "üßë‚Äç‚öïÔ∏è Esame obiettivo:\n" +
                "PA 82/50 mmHg, FC 128 bpm, FR 28/min, SatO‚ÇÇ 91% in aria ambiente, T 39.8¬∞C.\n" +
                "Paziente torpida, disorientata nel tempo; cute fredda, pallida, marezzata; CRT >3 sec.\n" +
                "Addome: dolente in fianco destro; Giordano positivo a destra. Diuresi <15 mL/h (da catetere vescicale).\n\n" +
                "üß™ Esami:\n" +
                "Leucociti 22√ó10^3/¬µL (neutrofili 92%, bandemia 8%), PCR 28 mg/dL, Procalcitonina 15 ng/mL.\n" +
                "Creatinina 3.8 mg/dL (basale 1.6), urea 125 mg/dL. Lattato 4.8 mmol/L.\n" +
                "Emogas: pH 7.28, HCO‚ÇÉ‚Åª 16 mEq/L, BE -9.\n" +
                "Urinocoltura in corso; urine: leucociti +++++, batteri +++, nitriti positivi.\n" +
                "Emocolture prelevate (2 set). Ecografia reni: idronefrosi moderata destra con calcolo pielico.\n\n" +
                "üìã Nota:\n" +
                "Paziente con criteri SOFA score 8 (ipotensione refrattaria a fluidi, AKI, ipossia, alterazione mentale).",
            options: [
                "Sepsi urinaria con shock settico e MODS (Multiple Organ Dysfunction Syndrome)",
                "Infarto miocardico acuto con insufficienza cardiaca",
                "Pielonefrite acuta non complicata",
                "Disidratazione severa da diabete scompensato"
            ],
            correctAnswer: 0,
            coordinates: "Vai in SOGGIORNO, il Drago Shenron ti attende sul TAVOLO PRINCIPALE! üêâ‚ú®"
        };

        let currentCase = 0;
        let collectedBalls = 0;

        // Funzione per riprodurre il suono del radar
        function playRadarSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let beepCount = 0;
            const maxBeeps = 6; // 6 beep in 3 secondi (uno ogni 0.5 secondi)
            
            function playBeep() {
                if (beepCount >= maxBeeps) return;
                
                // Beep principale del radar
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800; // Frequenza del beep
                oscillator.type = 'sine';
                
                // Envelope per il suono
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
                
                // Secondo beep leggermente pi√π alto
                setTimeout(() => {
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode2 = audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(audioContext.destination);
                    
                    oscillator2.frequency.value = 1000;
                    oscillator2.type = 'sine';
                    
                    gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode2.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    oscillator2.start(audioContext.currentTime);
                    oscillator2.stop(audioContext.currentTime + 0.2);
                }, 100);
                
                beepCount++;
                
                // Ripeti il beep dopo 0.5 secondi
                if (beepCount < maxBeeps) {
                    setTimeout(playBeep, 500);
                }
            }
            
            // Inizia la sequenza di beep
            playBeep();
        }

        function startHunt() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('caseScreen').style.display = 'block';
            loadCase(0);
        }

        function loadCase(caseIndex) {
            const caseData = cases[caseIndex];
            document.getElementById('caseNumber').textContent = caseIndex + 1;
            document.getElementById('caseTitle').textContent = caseData.title;
            document.getElementById('caseDescription').textContent = caseData.description;
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            caseData.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = function() {
                    selectOption(index);
                };
                
                optionDiv.innerHTML = `
                    <input type="radio" name="answer" id="option${index}" value="${index}">
                    <label for="option${index}">${option}</label>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
        }
        
        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('.option')[index].classList.add('selected');
            document.getElementById(`option${index}`).checked = true;
        }

        function checkAnswer() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedOption) {
                document.getElementById('errorMessage').textContent = '‚ö†Ô∏è Seleziona una risposta prima di procedere!';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                return;
            }
            
            const selectedIndex = parseInt(selectedOption.value);
            const correctIndex = cases[currentCase].correctAnswer;
            
            if (selectedIndex === correctIndex) {
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';
                
                setTimeout(() => {
                    showRadar();
                }, 1500);
            } else {
                document.getElementById('errorMessage').textContent = '‚ùå Risposta non corretta. Riprova!';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
            }
        }

        function showRadar() {
            collectedBalls++;
            document.getElementById('ballsCollected').textContent = collectedBalls;
            
            document.getElementById('caseScreen').style.display = 'none';
            document.getElementById('radarScreen').style.display = 'block';
            
            // Scroll istantaneo in alto (senza animazione)
            window.scrollTo(0, 0);
            
            // Riproduce il suono del radar
            playRadarSound();
            
            const starContainer = document.getElementById('currentStar');
            const starString = cases[currentCase].star;
            starContainer.innerHTML = '';
            
            // Posizioni predefinite per le stelle (ben centrate e distanziate)
            const starPositions = [
                [
                    {top: '50%', left: '50%'} // 1 stella: centrata
                ],
                [
                    {top: '40%', left: '40%'}, // 2 stelle: diagonale ben centrata
                    {top: '60%', left: '60%'}
                ],
                [
                    {top: '38%', left: '50%'}, // 3 stelle: triangolo centrato
                    {top: '62%', left: '40%'},
                    {top: '62%', left: '60%'}
                ],
                [
                    {top: '40%', left: '50%'}, // 4 stelle: rombo centrato
                    {top: '50%', left: '38%'},
                    {top: '50%', left: '62%'},
                    {top: '60%', left: '50%'}
                ],
                [
                    {top: '50%', left: '50%'}, // 5 stelle: croce centrata
                    {top: '35%', left: '38%'},
                    {top: '35%', left: '62%'},
                    {top: '65%', left: '38%'},
                    {top: '65%', left: '62%'}
                ],
                [
                    {top: '35%', left: '42%'}, // 6 stelle: due colonne centrate
                    {top: '50%', left: '42%'},
                    {top: '65%', left: '42%'},
                    {top: '35%', left: '58%'},
                    {top: '50%', left: '58%'},
                    {top: '65%', left: '58%'}
                ],
                [
                    {top: '50%', left: '50%'}, // 7 stelle: cerchio centrato + centro
                    {top: '30%', left: '50%'},
                    {top: '38%', left: '68%'},
                    {top: '62%', left: '68%'},
                    {top: '70%', left: '50%'},
                    {top: '62%', left: '32%'},
                    {top: '38%', left: '32%'}
                ]
            ];
            
            let starCount = 0;
            for (let char of starString) {
                if (char === '‚≠ê') {
                    starCount++;
                }
            }
            
            const positions = starPositions[starCount - 1] || [];
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Crea una stella SVG in stile Dragon Ball con colore rosso-arancione
                star.innerHTML = `
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <radialGradient id="starGradient-${i}" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#FF6B47;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#E53935;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#C62828;stop-opacity:1" />
                            </radialGradient>
                        </defs>
                        <polygon points="50,10 61,38 90,38 68,55 76,85 50,66 24,85 32,55 10,38 39,38" 
                                 fill="url(#starGradient-${i})" 
                                 stroke="#B71C1C" 
                                 stroke-width="2.5"
                                 stroke-linejoin="miter"/>
                    </svg>
                `;
                
                if (positions[i]) {
                    star.style.top = positions[i].top;
                    star.style.left = positions[i].left;
                    star.style.transform = 'translate(-50%, -50%)';
                }
                
                starContainer.appendChild(star);
            }
            
            document.getElementById('ballNumber').textContent = currentCase + 1;
            document.getElementById('starCount').textContent = starString;
            document.getElementById('coordinates').textContent = cases[currentCase].coordinates;
        }

        function nextCase() {
            currentCase++;
            
            if (currentCase >= cases.length) {
                document.getElementById('radarScreen').style.display = 'none';
                document.getElementById('completionScreen').style.display = 'block';
            } else {
                document.getElementById('radarScreen').style.display = 'none';
                document.getElementById('caseScreen').style.display = 'block';
                loadCase(currentCase);
            }
        }

        // Mostra il popup del colpo di scena
        function showFinalTwist() {
            document.getElementById('twistPopup').style.display = 'block';
        }

        // Inizia la sfida finale
        function startFinalChallenge() {
            document.getElementById('twistPopup').style.display = 'none';
            document.getElementById('completionScreen').style.display = 'none';
            document.getElementById('finalCaseScreen').style.display = 'block';
            loadFinalCase();
        }

        // Carica il caso finale
        function loadFinalCase() {
            document.getElementById('finalCaseTitle').textContent = finalCase.title;
            document.getElementById('finalCaseDescription').textContent = finalCase.description;
            document.getElementById('finalErrorMessage').style.display = 'none';
            document.getElementById('finalSuccessMessage').style.display = 'none';
            
            const optionsContainer = document.getElementById('finalOptionsContainer');
            optionsContainer.innerHTML = '';
            
            finalCase.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = function() {
                    selectFinalOption(index);
                };
                
                optionDiv.innerHTML = `
                    <input type="radio" name="finalAnswer" id="finalOption${index}" value="${index}">
                    <label for="finalOption${index}">${option}</label>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
        }

        // Seleziona opzione finale
        function selectFinalOption(index) {
            document.querySelectorAll('#finalOptionsContainer .option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('#finalOptionsContainer .option')[index].classList.add('selected');
            document.getElementById(`finalOption${index}`).checked = true;
        }

        // Controlla la risposta finale
        function checkFinalAnswer() {
            const selectedOption = document.querySelector('input[name="finalAnswer"]:checked');
            
            if (!selectedOption) {
                document.getElementById('finalErrorMessage').textContent = '‚ö†Ô∏è Seleziona una risposta per spezzare il sigillo!';
                document.getElementById('finalErrorMessage').style.display = 'block';
                document.getElementById('finalSuccessMessage').style.display = 'none';
                return;
            }
            
            const selectedIndex = parseInt(selectedOption.value);
            const correctIndex = finalCase.correctAnswer;
            
            if (selectedIndex === correctIndex) {
                document.getElementById('finalSuccessMessage').style.display = 'block';
                document.getElementById('finalErrorMessage').style.display = 'none';
                
                // Suono epico per l'evocazione
                playDragonSound();
                
                setTimeout(() => {
                    summonDragon();
                }, 2000);
            } else {
                document.getElementById('finalErrorMessage').textContent = '‚ùå Il sigillo resiste! La risposta non √® corretta!';
                document.getElementById('finalErrorMessage').style.display = 'block';
                document.getElementById('finalSuccessMessage').style.display = 'none';
            }
        }

        // Suono per l'evocazione del drago
        function playDragonSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Suono profondo e mistico
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(80, audioContext.currentTime + 2);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 2);
        }

        // Evoca il drago Shenron
        function summonDragon() {
            document.getElementById('finalCaseScreen').style.display = 'none';
            document.getElementById('dragonScreen').style.display = 'block';
            
            // Scroll istantaneo in alto (senza animazione)
            window.scrollTo(0, 0);
            
            document.getElementById('finalCoordinates').textContent = finalCase.coordinates;
        }
    </script>
</body>
</html>
